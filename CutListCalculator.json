{"metadata":{"title":"Cut List Calculator","description":"This program takes in the raw material types you plan to use (and their dimensions) and a list of pieces and their dimensions and quantities and outputs exactly how much material you'll need, and exactly what needs to be cut and joined to produce the requested piece dimensions.","author":"Philip Diffenderfer","created":"February 9, 2020 12:03 AM"},"type":["obj",{"buffer":"num","sources":["list",["@","Source"]],"name":"text","pieces":["list",["@","Piece"]],"pieceInstances":["list",["@","PieceInstance"]],"sourceInstances":["list",["@","SourceInstance"]],"pieceCuts":["list",["@","PieceCut"]],"remainingPieces":["list",["@","AvailablePiece"]]}],"settings":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"name","cols":12},{"prop":"buffer","cols":12},{"prop":"sources","cols":12},{"prop":"pieces","cols":12},{"prop":"pieceInstances","cols":12},{"prop":"sourceInstances","cols":12},{"prop":"pieceCuts","cols":12},{"prop":"remainingPieces","cols":12}]},"sub":{"buffer":{"input":"textbox","defaultValue":0,"options":{"label":"Cut Buffer","hint":"Blade width and potential slop","outlined":true,"suffix":"in."}},"sources":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"name","label":"Name"},{"prop":"thickness","label":"Thickness"},{"prop":"width","label":"Width"},{"prop":"length","label":"Length"},{"prop":"cost","label":"Cost"},{"prop":"type","label":"Type"}],"pageSize":10,"pagination":{},"title":"Available Materials","itemName":"Material"},"sub":{"item":{"input":"aliased","options":{},"defaultValue":null}}},"name":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password","outlined":true,"label":"Project Name"}},"pieces":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"name","label":"Name"},{"prop":"thickness","label":"Thickness"},{"prop":"width","label":"Width"},{"prop":"length","label":"Length"},{"prop":"quantity","label":"Quantity"},{"prop":"type","label":"Type"}],"pageSize":5,"pagination":{},"title":"Piece List","itemName":"Piece","paging":true},"sub":{"item":{"input":"aliased","options":{},"defaultValue":null}}},"pieceInstances":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"piece","label":"piece"},{"prop":"index","label":"index"},{"prop":"cuts","label":"cuts"}],"pageSize":10,"pagination":{},"title":"Piece Instances (output only)"},"sub":{"item":{"input":"aliased","options":{},"defaultValue":{}}}},"sourceInstances":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"source","label":"source"},{"prop":"index","label":"index"},{"prop":"cuts","label":"cuts"}],"pageSize":10,"pagination":{},"title":"Source Material Instances (output only)"},"sub":{"item":{"input":"aliased","options":{},"defaultValue":{}}}},"pieceCuts":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"from","label":"from"},{"prop":"cut","label":"cut"},{"prop":"piece","label":"piece"},{"prop":"piece_index","label":"piece_index"},{"prop":"join_index","label":"join_index"},{"prop":"join_count","label":"join_count"}],"pageSize":10,"pagination":{},"title":"Piece Cuts (output only)"},"sub":{"item":{"input":"aliased","options":{},"defaultValue":{}}}},"remainingPieces":{"input":"table","defaultValue":[],"options":{"columns":[{"prop":"instance","label":"instance"},{"prop":"cut_number","label":"cut_number"},{"prop":"cut_type","label":"cut_type"}],"pageSize":10,"pagination":{},"title":"Remaining Pieces (output only)"},"sub":{"item":{"input":"aliased","options":{},"defaultValue":{}}}}}},"data":{"buffer":0.25,"sources":[{"name":"2\" x 4\" x 8' raw","thickness":1.5,"width":3.5,"length":96,"cost":3.39,"type":0},{"name":"2\" x 4\" x 8' planed","thickness":1.25,"width":3.25,"length":96,"cost":3.39,"type":1},{"name":"2\" x 6\" x 8' planed","thickness":1.25,"width":5.25,"length":96,"cost":5.06,"type":1},{"name":"Birch Plywood 4' x 8'","thickness":0.75,"width":48,"length":96,"cost":54.46,"type":2}],"name":"Bag End Bed","pieces":[{"name":"Base / Slats","thickness":1.5,"width":3.5,"length":36.75,"quantity":12,"type":0},{"name":"Base / Front","thickness":1.25,"width":3.25,"length":75,"quantity":1,"type":1},{"name":"Base / Sides","thickness":1.25,"width":3.25,"length":36.75,"quantity":2,"type":1},{"name":"Base / Back","thickness":1.25,"width":10,"length":75,"quantity":1,"type":1},{"name":"Front / Top & Bottom Trim","thickness":0.5,"width":1.5,"length":75,"quantity":2,"type":1},{"name":"Front / Back Board","thickness":0.75,"width":8.75,"length":75,"quantity":1,"type":2},{"name":"Front / Top Moulding","thickness":0.5,"width":3,"length":75,"quantity":1,"type":1},{"name":"Front / Side Moulding & Corners","thickness":0.5,"width":4.5,"length":5.75,"quantity":2,"type":1},{"name":"Side / Back Board","thickness":0.75,"width":21.5,"length":41.25,"quantity":2,"type":2},{"name":"Side / Bottom Trim","thickness":0.5,"width":1.5,"length":41.25,"quantity":2,"type":1},{"name":"Side / Top Moulding","thickness":0.5,"width":3,"length":41.25,"quantity":2,"type":1},{"name":"Side / Side Moulding & Corners","thickness":0.5,"width":4.5,"length":5.75,"quantity":4,"type":1},{"name":"Side / Chair Rail","thickness":1,"width":2.75,"length":47.25,"quantity":2,"type":1},{"name":"Side / Middle Trim","thickness":0.5,"width":3,"length":47.5,"quantity":2,"type":1},{"name":"Side / Top Trim","thickness":0.5,"width":4,"length":47,"quantity":2,"type":1},{"name":"Side / Front Post","thickness":2,"width":4,"length":30,"quantity":2,"type":1},{"name":"Side / Back Post","thickness":3.75,"width":4,"length":30,"quantity":2,"type":1},{"name":"Back / Frame / Posts","thickness":2,"width":3.25,"length":63,"quantity":2,"type":1},{"name":"Back / Frame / Bottom","thickness":1.5,"width":7,"length":71,"quantity":1,"type":1},{"name":"Back / Frame / Back","thickness":0.75,"width":43,"length":71,"quantity":1,"type":2},{"name":"Back / Supports/ Main","thickness":2,"width":7.75,"length":23,"quantity":4,"type":1},{"name":"Back / Supports / Bottom Trim","thickness":1.5,"width":3,"length":3.75,"quantity":4,"type":1},{"name":"Back / Supports/ Bottom Decoration","thickness":2,"width":3.25,"length":4,"quantity":4,"type":1},{"name":"Back / Top / Shelf","thickness":1,"width":11,"length":18.5,"quantity":2,"type":1},{"name":"Back / Top / Arched Shelf","thickness":2,"width":14,"length":20,"quantity":2,"type":1},{"name":"Back / Top / Support","thickness":2,"width":5,"length":10.25,"quantity":1,"type":1},{"name":"Back / Top / Side Moulding","thickness":0.5,"width":5.5,"length":14.5,"quantity":2,"type":1},{"name":"Back / Top / Arched Moulding","thickness":0.5,"width":9,"length":18,"quantity":2,"type":1},{"name":"Back / Door Bricks / Pronounced","thickness":0.5,"width":1,"length":4.25,"quantity":14,"type":1},{"name":"Back / Door Bricks / Inner","thickness":0.25,"width":1,"length":2,"quantity":112,"type":1},{"name":"Back / Door Bricks / Circle","thickness":0.5,"width":1,"length":3.75,"quantity":98,"type":1},{"name":"Back / Door Bricks / Sides","thickness":0.25,"width":1,"length":3.75,"quantity":48,"type":1},{"name":"Back / Door / Trim","thickness":2,"width":7,"length":13,"quantity":8,"type":1},{"name":"Back / Door / Stop Trim","thickness":0.5,"width":7,"length":13,"quantity":8,"type":1},{"name":"Back / Window / Outline Bricks","thickness":0.5,"width":1,"length":3,"quantity":50,"type":1},{"name":"Back / Window / Sill Bricks","thickness":1,"width":1,"length":3,"quantity":18,"type":1}],"pieceInstances":[],"sourceInstances":[],"pieceCuts":[],"remainingPieces":[]},"program":["def",[["mins",["invoke","getPieceMinimums",{"pieces":["get",["pieces"]]}]],["available",["invoke","getAvailablePieces",{"sources":["get",["sources"]],"sourceInstances":["get",["sourceInstances"]]}]]],["chain",[["invoke","sortPieces",{"pieces":["get",["pieces"]]}],["op","list:each",{"list":["get",["pieces"]],"each":["def",[["plan",["invoke","getPlan",{"piece":["get",["piece"]],"sources":["get",["sources"]],"epsilon":0.01}]]],["for","piece_index",0,["get",["piece","quantity"]],["def",[["pieceInstance",["obj",{"piece":["get",["piece","name"]],"index":["get",["piece_index"]],"cuts":["op","list:createFor",{"item":0}]}]]],["chain",[["op","list:+",{"list":["get",["pieceInstances"]],"item":["get",["pieceInstance"]]}],["op","list:each",{"list":["get",["plan"]],"each":["def",[["chosen",["invoke","chooseAvailable",{"piece":["get",["piece"]],"available":["get",["available"]],"partNormal":["get",["partNormal"]]}]],["remainingMaterial",["invoke","getRemainingMaterial",{"source":["get",["chosen","available"]],"piece":["get",["chosen","part"]],"buffer":["get",["buffer"]],"mins":["get",["mins"]]}]],["remaining",["get",["remainingMaterial","remaining"]]],["has",["get",["remainingMaterial","has"]]],["chosenSourceInstance",["op","any:require",{"value":["get",["sourceInstances",["get",["chosen","available","instance"]]]]}]]],["chain",[["if",[[["get",["chosenSourceInstance","template"]],["chain",[["set",["chosenSourceInstance"],["obj",{"source":["get",["chosenSourceInstance","source"]],"index":["get",["sourceInstances","length"]],"cuts":["op","list:createFor",{"item":0}],"template":false}]],["set",["chosen","available"],["op","obj:merge",{"a":["op","any:require",{"value":["get",["chosen","available"]]}],"b":["obj",{"instance":["get",["chosenSourceInstance","index"]]}]}]],["op","list:+",{"list":["get",["sourceInstances"]],"item":["get",["chosenSourceInstance"]]}]]]]],["op","list:-@",{"list":["get",["available"]],"index":["get",["chosen","index"]]}]],["invoke","cutLength",{"has":["get",["has"]],"available":["get",["available"]],"chosen":["get",["chosen"]],"remaining":["get",["remaining"]]}],["invoke","cutWidthAndThickness",{"has":["get",["has"]],"remaining":["get",["remaining"]],"available":["get",["available"]],"chosen":["get",["chosen"]]}],["op","list:+",{"list":["get",["chosenSourceInstance","cuts"]],"item":["get",["pieceCuts","length"]]}],["op","list:+",{"list":["get",["pieceInstance","cuts"]],"item":["get",["pieceCuts","length"]]}],["op","list:+",{"list":["get",["pieceCuts"]],"item":["obj",{"from":["get",["chosen","available"]],"cut":["get",["chosen","part"]],"piece":["get",["piece","name"]],"id":["get",["pieceCuts","length"]],"piece_index":["get",["piece_id"]],"join_index":["get",["join_index"]],"join_count":["get",["plan","length"]]}]}],["invoke","sortAvailable",{"available":["get",["available"]]}]]]]},{"list":"list1","index":"join_index","item":"partNormal"}]]]]]]},{"item":"piece","index":"piece_id"}],["op","list:-?",{"list":["get",["sourceInstances"]],"where":["get",["item","template"]]}],["invoke","finalOutput",{"pieces":["get",["pieces"]],"sourceInstances":["get",["sourceInstances"]],"sources":["get",["sources"]],"pieceCuts":["get",["pieceCuts"]],"pieceInstances":["get",["pieceInstances"]]}]]]],"functions":{"fitsInside":["func","bool",["obj",{"inside":["@","Dimensional"],"outside":["@","Dimensional"]}],["return",["and",[["op","num:<=",{"value":["get",["inside","length"]],"test":["get",["outside","length"]]}],["op","num:<=",{"value":["get",["inside","thickness"]],"test":["get",["outside","thickness"]]}],["op","num:<=",{"value":["get",["inside","width"]],"test":["get",["outside","width"]]}]]]]],"intersectVolume":["func",["obj",{"width":"num","thickness":"num","length":"num"}],["obj",{"a":["@","Dimensional"],"b":["@","Dimensional"]}],["return",["obj",{"width":["op","num:min",{"a":["get",["a","width"]],"b":["get",["b","width"]]}],"thickness":["op","num:min",{"a":["get",["a","thickness"]],"b":["get",["b","thickness"]]}],"length":["op","num:min",{"a":["get",["a","length"]],"b":["get",["b","length"]]}]}]]],"computeVolume":["func","num",["obj",{"piece":["@","Dimensional"]}],["return",["op","num:*",{"value":["op","num:*",{"value":["get",["piece","thickness"]],"multiplier":["get",["piece","width"]]}],"multiplier":["get",["piece","length"]]}]]],"getPieceMinimums":["func",["obj",{"length":"num","width":"num","thickness":"num"}],["obj",{"pieces":["list",["@","Dimensional"]]}],["def",[["min_length",["op","any:~num",{"value":["op","list:min",{"list":["get",["pieces"]],"value":["get",["item","length"]]}]}]],["min_thickness",["op","any:~num",{"value":["op","list:min",{"list":["get",["pieces"]],"value":["get",["item","thickness"]]}]}]],["min_width",["op","any:~num",{"value":["op","list:min",{"list":["get",["pieces"]],"value":["get",["item","width"]]}]}]]],["return",["obj",{"length":["get",["min_length"]],"width":["op","num:min",{"a":["get",["min_thickness"]],"b":["get",["min_width"]]}],"thickness":["op","num:min",{"a":["get",["min_thickness"]],"b":["get",["min_width"]]}]}]]]],"getBestMatch":["func",["@","JoinResult"],["obj",{"best":["@","JoinResult"],"curr":["@","JoinResult"]}],["return",["if",[[["op","num:<",{"value":["get",["best","total"]],"test":["get",["curr","total"]]}],["get",["best"]]],[["op","num:>",{"value":["get",["best","volume"]],"test":["get",["curr","volume"]]}],["get",["best"]]],[["op","num:<",{"value":["get",["best","remaining"]],"test":["get",["curr","remaining"]]}],["get",["best"]]]],["get",["curr"]]]]],"sortPieces":["func",["list",["@","Piece"]],["obj",{"pieces":["list",["@","Piece"]]}],["return",["op","list:sort",{"list":["get",["pieces"]],"compare":["op","num:cmp",{"value":["invoke","computeVolume",{"piece":["get",["test"]]}],"test":["invoke","computeVolume",{"piece":["get",["value"]]}]}]}]]],"rotate":["func",["obj",{"thickness":"num","width":"num","length":"num"}],["obj",{"piece":["@","Dimensional"]}],["return",["op","obj:merge",{"a":["get",["piece"]],"b":["obj",{"width":["get",["piece","thickness"]],"thickness":["get",["piece","width"]]}]}]]],"getRemainingMaterial":["func",["obj",{"remaining":["obj",{"length":"num","width":"num","thickness":"num"}],"has":["obj",{"length":"bool","width":"bool","thickness":"bool"}]}],["obj",{"source":["@","AvailablePiece"],"piece":["@","Dimensional"],"buffer":"num","mins":["@","Dimensional"]}],["def",[["remaining",["obj",{"length":["op","num:-",{"value":["op","num:-",{"value":["get",["source","length"]],"subtrahend":["get",["piece","length"]]}],"subtrahend":["get",["buffer"]]}],"width":["op","num:-",{"value":["op","num:-",{"value":["get",["source","width"]],"subtrahend":["get",["piece","width"]]}],"subtrahend":["get",["buffer"]]}],"thickness":["op","num:-",{"value":["op","num:-",{"value":["get",["source","thickness"]],"subtrahend":["get",["piece","thickness"]]}],"subtrahend":["get",["buffer"]]}]}]],["has",["obj",{"length":["op","num:>=",{"value":["get",["remaining","length"]],"test":["get",["mins","length"]]}],"width":["op","num:>=",{"value":["get",["remaining","width"]],"test":["get",["mins","width"]]}],"thickness":["op","num:>=",{"value":["get",["remaining","thickness"]],"test":["get",["mins","thickness"]]}]}]]],["return",["obj",{"remaining":["get",["remaining"]],"has":["get",["has"]]}]]]],"sortAvailable":["func",["list",["@","AvailablePiece"]],["obj",{"available":["list",["@","AvailablePiece"]]}],["return",["op","list:sort",{"list":["get",["available"]],"compare":["op","num:cmp",{"value":["invoke","computeVolume",{"piece":["get",["value"]]}],"test":["invoke","computeVolume",{"piece":["get",["test"]]}]}]}]]],"computeJoining":["func",["obj",{"thick":"num","wide":"num","total":"num","intersect":["obj",{"width":"num","thickness":"num","length":"num"}],"volume":"num","remaining":"num","source":["obj",{"name":"text","thickness":"num","width":"num","length":"num","cost":"num","planed":"bool"}]}],["obj",{"source":["@","Source"],"piece":["@","Dimensional"]}],["def",[["thick",["op","num:/",{"value":["get",["piece","thickness"]],"divisor":["get",["source","thickness"]]}]],["wide",["op","num:/",{"value":["get",["piece","width"]],"divisor":["get",["source","width"]]}]],["total",["op","num:*",{"value":["op","num:ceil",{"value":["get",["thick"]]}],"multiplier":["op","num:ceil",{"value":["get",["wide"]]}]}]],["intersect",["invoke","intersectVolume",{"a":["get",["source"]],"b":["get",["piece"]]}]],["volume",["invoke","computeVolume",{"piece":["get",["intersect"]]}]],["remaining",["op","num:-",{"value":["invoke","computeVolume",{"piece":["get",["source"]]}],"subtrahend":["get",["volume"]]}]]],["return",["obj",{"thick":["get",["thick"]],"wide":["get",["wide"]],"total":["get",["total"]],"intersect":["get",["intersect"]],"volume":["get",["volume"]],"remaining":["get",["remaining"]],"source":["get",["source"]]}]]]],"getPlan":["func",["list",["obj",{"width":"num","thickness":"num","length":"num"}]],["obj",{"piece":["@","Piece"],"sources":["list",["@","Source"]],"epsilon":"num"}],["def",[["rotated",["invoke","rotate",{"piece":["get",["piece"]]}]],["compatible",["op","list:filter",{"list":["get",["sources"]],"filter":["invoke","isCompatible",{"piece":["get",["piece"]],"source":["get",["source"]]}]},{"item":"source"}]],["options",["op","list:append",{"list":["op","list:map",{"list":["get",["compatible"]],"transform":["invoke","computeJoining",{"source":["get",["source"]],"piece":["get",["piece"]]}]},{"item":"source"}],"append":["op","list:map",{"list":["get",["compatible"]],"transform":["invoke","computeJoining",{"source":["get",["source"]],"piece":["get",["rotated"]]}]},{"item":"source"}]}]],["chosen",["op","list:reduce",{"list":["get",["options"]],"reduce":["invoke","getBestMatch",{"best":["get",["reduced"]],"curr":["get",["item"]]}],"initial":["comp","list:first",["get",["options"]]]}]],["joins",["op","list:createFor",{"item":["obj",{"width":0,"thickness":0,"length":0}]}]],["wide",["op","num:floor",{"value":["get",["chosen","wide"]]}]],["thick",["op","num:floor",{"value":["get",["chosen","thick"]]}]],["widthRemaining",["op","num:*",{"value":["op","num:%",{"value":["get",["chosen","wide"]],"divisor":1}],"multiplier":["get",["chosen","source","width"]]}]],["thickRemaining",["op","num:*",{"value":["op","num:%",{"value":["get",["chosen","thick"]],"divisor":1}],"multiplier":["get",["chosen","source","thickness"]]}]],["widthNeeded",["op","num:>",{"value":["get",["widthRemaining"]],"test":["get",["epsilon"]]}]],["thickNeeded",["op","num:>",{"value":["get",["thickRemaining"]],"test":["get",["epsilon"]]}]]],["chain",[["for","x",0,["get",["wide"]],["for","y",0,["get",["thick"]],["op","list:+",{"list":["get",["joins"]],"item":["get",["chosen","intersect"]]}]]],["if",[[["and",[["get",["widthNeeded"]],["op","num:>",{"value":["get",["thick"]],"test":0}]]],["for","z",0,["get",["thick"]],["op","list:+",{"list":["get",["joins"]],"item":["obj",{"length":["get",["chosen","intersect","length"]],"width":["get",["widthRemaining"]],"thickness":["get",["chosen","intersect","thickness"]]}]}]]]],["noop"]],["if",[[["and",[["get",["thickNeeded"]],["op","num:>",{"value":["get",["wide"]],"test":0}]]],["for","z",0,["get",["wide"]],["op","list:+",{"list":["get",["joins"]],"item":["obj",{"length":["get",["chosen","intersect","length"]],"width":["get",["chosen","intersect","width"]],"thickness":["get",["thickRemaining"]]}]}]]]],["noop"]],["if",[[["and",[["get",["thickNeeded"]],["get",["widthNeeded"]]]],["op","list:+",{"list":["get",["joins"]],"item":["obj",{"length":["get",["chosen","intersect","length"]],"width":["get",["widthRemaining"]],"thickness":["get",["thickRemaining"]]}]}]]],["noop"]],["return",["get",["joins"]]]]]]],"isCompatible":["func","bool",["obj",{"piece":["@","Piece"],"source":["@","Source"]}],["return",["and",[["op","num:=",{"value":["get",["source","type"]],"test":["get",["piece","type"]]}],["op","num:>=",{"value":["get",["source","length"]],"test":["get",["piece","length"]]}]]]]],"chooseAvailable":["func",["obj",{"index":["num",{"max":null,"min":null}],"part":["many",[["@","Dimensional"],["obj",{"thickness":"num","width":"num","length":"num"}]]],"available":["obj",{"instance":"num","cut_number":"num","cut_type":["?","text"],"thickness":"num","width":"num","length":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]}],["obj",{"available":["list",["@","AvailablePiece"]],"partNormal":["@","Dimensional"],"piece":["@","Piece"]}],["return",["def",[["partRotated",["invoke","rotate",{"piece":["get",["partNormal"]]}]],["indexNormal",["op","list:findIndex",{"list":["get",["available"]],"where":["and",[["invoke","fitsInside",{"inside":["get",["partNormal"]],"outside":["get",["available_item"]]}],["op","num:=",{"value":["get",["piece","type"]],"test":["get",["available_item","type"]]}]]]},{"list":"list2","item":"available_item"}]],["indexRotated",["op","list:findIndex",{"list":["get",["available"]],"where":["and",[["invoke","fitsInside",{"inside":["get",["partRotated"]],"outside":["get",["available_item"]]}],["op","num:=",{"value":["get",["piece","type"]],"test":["get",["available_item","type"]]}]]]},{"list":"list2","item":"available_item"}]],["index",["if",[[["and",[["op","num:!=",{"value":["get",["indexNormal"]],"test":-1}],["op","num:!=",{"value":["get",["indexRotated"]],"test":-1}]]],["op","num:min",{"a":["get",["indexNormal"]],"b":["get",["indexRotated"]]}]]],["op","num:max",{"a":["get",["indexNormal"]],"b":["get",["indexRotated"]]}]]],["part",["if",[[["op","num:=",{"value":["get",["index"]],"test":["get",["indexNormal"]]}],["get",["partNormal"]]]],["get",["partRotated"]]]]],["obj",{"index":["get",["index"]],"part":["get",["part"]],"available":["op","any:require",{"value":["get",["available",["get",["index"]]]]}]}]]]],"cutWidthAndThickness":["func",["many",[["list",["obj",{"length":["num",{"max":null,"min":null}],"width":["num",{"max":null,"min":null}],"thickness":["num",{"max":null,"min":null}],"cut_number":["num",{"max":null,"min":null}],"cut_type":["text",{"max":null,"min":null}],"instance":["num",{"max":null,"min":null}],"type":["enum",["text",{"max":null,"min":null}],["num",{"max":null,"min":null}],[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}],{"min":null,"max":null}],"null"]],["obj",{"has":["obj",{"length":"bool","width":"bool","thickness":"bool"}],"remaining":["obj",{"length":"num","width":"num","thickness":"num"}],"available":["list",["obj",{"length":"num","width":"num","thickness":"num","cut_number":"num","cut_type":"text","instance":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]],"chosen":["obj",{"index":["num",{"max":null,"min":null}],"part":["many",[["@","Dimensional"],["obj",{"thickness":"num","width":"num","length":"num"}]]],"available":["obj",{"instance":"num","cut_number":"num","cut_type":["?","text"],"thickness":"num","width":"num","length":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]}]}],["return",["if",[[["and",[["get",["has","width"]],["get",["has","thickness"]]]],["if",[[["op","num:>",{"value":["get",["remaining","thickness"]],"test":["get",["remaining","width"]]}],["chain",[["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"thickness":["get",["remaining","thickness"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"thickness","length":["get",["chosen","part","length"]]}]}]}],["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"width":["get",["remaining","width"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"width","length":["get",["chosen","part","length"]],"thickness":["get",["chosen","part","thickness"]]}]}]}]]]]],["chain",[["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"width":["get",["remaining","width"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"width","length":["get",["chosen","part","length"]]}]}]}],["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"thickness":["get",["remaining","thickness"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"thickness","length":["get",["chosen","part","length"]],"width":["get",["chosen","part","width"]]}]}]}]]]]],[["get",["has","width"]],["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"width":["get",["remaining","width"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"width","length":["get",["chosen","part","length"]]}]}]}]],[["get",["has","thickness"]],["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["get",["chosen","available"]],"b":["obj",{"thickness":["get",["remaining","thickness"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"thickness","length":["get",["chosen","part","length"]]}]}]}]]],["noop"]]]],"flattenPieceCut":["func",["obj",{"from_instance":"num","from_cut_number":"num","from_cut_type":["?","text"],"from_thickness":"num","from_width":"num","from_length":"num","from_type":"num","thickness":"num","width":"num","length":"num","piece":"text","piece_index":"num","join_index":"num","join_count":"num","id":"num"}],["obj",{"cut":["@","PieceCut"]}],["return",["obj",{"from_instance":["get",["cut","from","instance"]],"from_cut_number":["get",["cut","from","cut_number"]],"from_cut_type":["get",["cut","from","cut_type"]],"from_thickness":["get",["cut","from","thickness"]],"from_width":["get",["cut","from","width"]],"from_length":["get",["cut","from","length"]],"from_type":["get",["cut","from","type"]],"thickness":["get",["cut","cut","thickness"]],"width":["get",["cut","cut","width"]],"length":["get",["cut","cut","length"]],"piece":["get",["cut","piece"]],"piece_index":["get",["cut","piece_index"]],"join_index":["get",["cut","join_index"]],"join_count":["get",["cut","join_count"]],"id":["get",["cut","id"]]}]]],"flattenSourceInstance":["func",["obj",{"source":"text","index":"num","cuts":"text"}],["obj",{"instance":["@","SourceInstance"]}],["return",["obj",{"source":["get",["instance","source"]],"index":["get",["instance","index"]],"cuts":["op","list:join",{"list":["get",["instance","cuts"]]}]}]]],"flattenPieceInstance":["func",["obj",{"piece":"text","index":"num","cuts":"text"}],["obj",{"piece":["@","PieceInstance"]}],["return",["obj",{"piece":["get",["piece","piece"]],"index":["get",["piece","index"]],"cuts":["op","list:join",{"list":["get",["piece","cuts"]]}]}]]],"finalOutput":["func",["obj",{"totalPieces":["?","num"],"totalCost":["?","num"],"summary":["list",["obj",{"source":"text","quantity":["num",{"min":0,"whole":true}]}]],"cuts":["list",["obj",{"from_instance":"num","from_cut_number":"num","from_cut_type":["?","text"],"from_thickness":"num","from_width":"num","from_length":"num","from_type":"num","thickness":"num","width":"num","length":"num","piece":"text","piece_index":"num","join_index":"num","join_count":"num","id":"num"}]],"sources":["list",["obj",{"source":"text","index":"num","cuts":"text"}]],"pieces":["list",["obj",{"piece":"text","index":"num","cuts":"text"}]]}],["obj",{"pieces":["list",["@","Piece"]],"sourceInstances":["list",["@","SourceInstance"]],"sources":["list",["@","Source"]],"pieceCuts":["list",["@","PieceCut"]],"pieceInstances":["list",["@","PieceInstance"]]}],["return",["obj",{"totalPieces":["op","list:sum",{"list":["get",["pieces"]],"value":["get",["item","quantity"]]}],"totalCost":["op","list:sum",{"list":["get",["sourceInstances"]],"value":["sub",["op","list:find",{"list":["get",["sources"]],"where":["op","text:=",{"a":["get",["item","source"]],"b":["get",["source","name"]]}]},{"item":"source"}],["cost"]]}],"summary":["op","list:map",{"list":["op","list:group",{"list":["get",["sourceInstances"]],"by":["get",["item","source"]]}],"transform":["obj",{"source":["get",["item","by"]],"quantity":["get",["item","group","length"]]}]}],"cuts":["op","list:map",{"list":["get",["pieceCuts"]],"transform":["invoke","flattenPieceCut",{"cut":["get",["cut"]]}]},{"item":"cut"}],"sources":["op","list:map",{"list":["get",["sourceInstances"]],"transform":["invoke","flattenSourceInstance",{"instance":["get",["sourceInstance"]]}]},{"item":"sourceInstance"}],"pieces":["op","list:map",{"list":["get",["pieceInstances"]],"transform":["invoke","flattenPieceInstance",{"piece":["get",["piece"]]}]},{"item":"piece"}]}]]],"getAvailablePieces":["func",["list",["obj",{"length":"num","width":"num","thickness":"num","type":"num","cut_number":"num","cut_type":"text","instance":"num"}]],["obj",{"sources":["list",["@","Source"]],"sourceInstances":["list",["@","SourceInstance"]]}],["return",["op","list:map",{"list":["get",["sources"]],"transform":["chain",[["op","list:+",{"list":["get",["sourceInstances"]],"item":["obj",{"source":["get",["source","name"]],"index":-1,"cuts":["op","list:createFor",{"item":0}],"template":true}]}],["obj",{"length":["get",["source","length"]],"width":["get",["source","width"]],"thickness":["get",["source","thickness"]],"type":["get",["source","type"]],"cut_number":0,"cut_type":"","instance":["get",["index"]]}]]]},{"item":"source"}]]],"cutLength":["func",["many",[["list",["obj",{"length":"num","width":"num","thickness":"num","cut_number":"num","cut_type":"text","instance":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]],"null"]],["obj",{"has":["obj",{"length":"bool","width":"bool","thickness":"bool"}],"available":["list",["obj",{"length":"num","width":"num","thickness":"num","cut_number":"num","cut_type":"text","instance":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]],"chosen":["obj",{"index":["num",{"max":null,"min":null}],"part":["many",[["@","Dimensional"],["obj",{"thickness":"num","width":"num","length":"num"}]]],"available":["obj",{"instance":"num","cut_number":"num","cut_type":["?","text"],"thickness":"num","width":"num","length":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}]}],"remaining":["obj",{"length":"num","width":"num","thickness":"num"}]}],["return",["if",[[["get",["has","length"]],["op","list:+",{"list":["get",["available"]],"item":["op","obj:merge",{"a":["op","any:require",{"value":["get",["chosen","available"]]}],"b":["obj",{"length":["get",["remaining","length"]],"cut_number":["op","num:+",{"value":["get",["chosen","available","cut_number"]],"addend":1}],"cut_type":"length"}]}]}]]],["noop"]]]]},"aliased":{"Source":["obj",{"name":"text","thickness":"num","width":"num","length":"num","cost":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}],"Piece":["obj",{"name":"text","thickness":"num","width":"num","length":"num","quantity":["num",{"whole":true}],"type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}],"Dimensional":["obj",{"thickness":"num","width":"num","length":"num"}],"SourceInstance":["obj",{"source":"text","index":"num","cuts":["list","num"],"template":"bool"}],"AvailablePiece":["obj",{"instance":"num","cut_number":"num","cut_type":["?","text"],"thickness":"num","width":"num","length":"num","type":["enum","text","num",[["Raw Lumber",0],["Planed Lumber",1],["Plywood",2]]]}],"PieceInstance":["obj",{"piece":"text","index":"num","cuts":["list","num"]}],"PieceCut":["obj",{"from":["@","AvailablePiece"],"cut":["@","Dimensional"],"piece":"text","piece_index":"num","join_index":"num","join_count":"num","id":"num"}],"JoinResult":["obj",{"thick":"num","wide":"num","total":"num","intersect":["@","Dimensional"],"volume":"num","remaining":"num","source":["@","Source"]}]},"aliasedSettings":{"Source":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"name","cols":12},{"prop":"thickness","cols":12},{"prop":"width","cols":12},{"prop":"length","cols":12},{"prop":"cost","cols":12},{"prop":"type","cols":12}]},"sub":{"name":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password","hint":"A short description of the source material","outlined":true}},"thickness":{"input":"textbox","defaultValue":0,"options":{"hint":"Smallest dimension","outlined":true,"suffix":"in."}},"width":{"input":"textbox","defaultValue":0,"options":{"hint":"Median dimension","outlined":true,"suffix":"in."}},"length":{"input":"textbox","defaultValue":0,"options":{"hint":"Largest dimension","outlined":true,"suffix":"in."}},"cost":{"input":"textbox","defaultValue":0,"options":{"prefix":"$","outlined":true,"hint":"Used to estimate project cost"}},"type":{"input":"dropdown","defaultValue":0,"options":{"outlined":true,"hint":"The type of material, pieces find a source material based on type first."},"sub":{"key":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"value":{"input":"textbox","defaultValue":0,"options":{}}}}}},"Piece":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"name","cols":12},{"prop":"thickness","cols":12},{"prop":"width","cols":12},{"prop":"length","cols":12},{"prop":"quantity","cols":12},{"prop":"type","cols":12}]},"sub":{"name":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password","hint":"Brief description of piece","outlined":true}},"thickness":{"input":"textbox","defaultValue":0,"options":{"hint":"Smallest dimension","outlined":true,"suffix":"in."}},"width":{"input":"textbox","defaultValue":0,"options":{"hint":"Median dimension","outlined":true,"suffix":"in."}},"length":{"input":"textbox","defaultValue":0,"options":{"hint":"Largest dimension","outlined":true,"suffix":"in."}},"quantity":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"hint":"How many you need"}},"type":{"input":"dropdown","defaultValue":0,"options":{"outlined":true,"hint":"The type of material, pieces find a source material based on type first."},"sub":{"key":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"value":{"input":"textbox","defaultValue":0,"options":{}}}}}},"Dimensional":{"input":"form","defaultValue":{"thickness":0,"width":0,"length":0},"options":{"columns":[{"prop":"thickness","cols":12},{"prop":"width","cols":12},{"prop":"length","cols":12},{"prop":"length","cols":12}],"label":"inside"},"sub":{"thickness":{"input":"textbox","defaultValue":0,"options":{"hint":"Smallest dimension","outlined":true,"suffix":"in."}},"width":{"input":"textbox","defaultValue":0,"options":{"hint":"Median dimension","outlined":true,"suffix":"in."}},"length":{"input":"textbox","defaultValue":0,"options":{"hint":"Largest dimension","outlined":true,"suffix":"in."}}}},"SourceInstance":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"source","cols":12},{"prop":"index","cols":12},{"prop":"cuts","cols":12},{"prop":"template","cols":12}],"label":""},"sub":{"source":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"index":{"input":"textbox","defaultValue":0,"options":{}},"cuts":{"input":"list","defaultValue":[],"options":{"pageSize":10,"pagination":{}},"sub":{"item":{"input":"textbox","defaultValue":0,"options":{}}}},"template":{"input":"checkbox","defaultValue":false,"options":{}}}},"AvailablePiece":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"instance","cols":12},{"prop":"cut_number","cols":12},{"prop":"cut_type","cols":12},{"prop":"thickness","cols":12},{"prop":"width","cols":12},{"prop":"length","cols":12},{"prop":"type","cols":12}],"label":""},"sub":{"instance":{"input":"textbox","defaultValue":0,"options":{}},"cut_number":{"input":"textbox","defaultValue":0,"options":{}},"cut_type":{"input":"optional","options":{},"sub":{"innerType":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}}}},"thickness":{"input":"textbox","defaultValue":0,"options":{}},"width":{"input":"textbox","defaultValue":0,"options":{}},"length":{"input":"textbox","defaultValue":0,"options":{}},"type":{"input":"dropdown","defaultValue":0,"options":{"outlined":true,"hint":"The type of material, pieces find a source material based on type first."},"sub":{"key":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"value":{"input":"textbox","defaultValue":0,"options":{}}}}}},"PieceInstance":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"piece","cols":12},{"prop":"index","cols":12},{"prop":"cuts","cols":12}],"label":""},"sub":{"piece":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"index":{"input":"textbox","defaultValue":0,"options":{}},"cuts":{"input":"list","defaultValue":[],"options":{"pageSize":10,"pagination":{}},"sub":{"item":{"input":"textbox","defaultValue":0,"options":{}}}}}},"PieceCut":{"input":"form","defaultValue":{},"options":{"columns":[{"prop":"from","cols":12},{"prop":"cut","cols":12},{"prop":"piece","cols":12},{"prop":"piece_index","cols":12},{"prop":"join_index","cols":12},{"prop":"join_count","cols":12},{"prop":"id","cols":12}],"label":""},"sub":{"from":{"input":"aliased","options":{},"defaultValue":{}},"cut":{"input":"aliased","options":{},"defaultValue":{}},"piece":{"input":"textbox","defaultValue":"","options":{"autocomplete":"new-password"}},"piece_index":{"input":"textbox","defaultValue":0,"options":{}},"join_index":{"input":"textbox","defaultValue":0,"options":{}},"join_count":{"input":"textbox","defaultValue":0,"options":{}},"id":{"input":"textbox","defaultValue":0,"options":{}}}},"JoinResult":{"input":"form","defaultValue":{"thick":0,"wide":0,"total":0,"intersect":{"width":0,"thickness":0,"length":0},"volume":0,"remaining":0},"options":{"columns":[{"prop":"thick","cols":12},{"prop":"wide","cols":12},{"prop":"total","cols":12},{"prop":"intersect","cols":12},{"prop":"volume","cols":12},{"prop":"remaining","cols":12},{"prop":"source","cols":12}],"label":""},"sub":{"thick":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"label":"thick"}},"wide":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"label":"wide"}},"total":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"label":"total"}},"intersect":{"input":"aliased","options":{},"defaultValue":{}},"volume":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"label":"volume"}},"remaining":{"input":"textbox","defaultValue":0,"options":{"outlined":true,"label":"remaining"}},"source":{"input":"aliased","options":{},"defaultValue":{}}}}},"aliasedData":{"Source":[],"Piece":[],"Dimensional":[],"SourceInstance":[],"AvailablePiece":[],"PieceInstance":[],"PieceCut":[],"JoinResult":[]},"storage":{},"relations":{}}